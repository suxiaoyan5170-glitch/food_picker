<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAMAAAC8Y9NQAAAAflBMVEUAAAD///+ZzP8Anf8Aov8Amv8AlP8Aqv8Aru8Anv8Amf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8+S878AAAALHRSTlMAAgMEBQYICQoLDA0ODxITFBUWFxgZGhscHR4fICEiIyQlJicoKSorLC0uLzAyYm98AAADfklEQVR42u2b2ZKiMBSG6Y6ICwiCuyK7oiIu77/S6YI6pS0SuAnTOf9vXpIsS/6T9CStVAsLCwsLCwsLCwsLC5vIdI59f6E9yGofBclKjO8T36Y9x5ovp3W9v6D9L1Hk++Fm62v7X+K680U2qfX+gnSAnX6W6v0FCXp/QTrA82T6pPr67/8LkuM8nU6fA+MvSJDmP9Ppc+A9Vf8XJMn0fDqdPmP9X5CcTOfp9Bmz/oKkkOnV6TNR/xc0S86m06fA7P8LmmM6nz4DZv9f0DyfptOnwGf8Bcm5m6fT58Bl/AXJWZpOnwPn8RckZ0un0+fAefwFyVkt06fA97v6779z/3f0v/P0Of9vSJK5/f7D3P4/p86Xf9m+f9L5/knnf9L5/knnf9L5/knnf9L5/knnf9L5/knnf9L5/knnf/L5fX069/90Wf/H38B1X7R+B8XnE4vPZ7Otz2Zdn82mPptVfTar+mxW9dlmS6U5WyrN2VJpzpZK602ltN5USutNpbTeVErrTaW03lRar7XGfK015mutMV9rjflaY77WGPu7mGv7u5hr+7uYa/u7mGv7u5hr+7uY6zNrrM+ssT6zxvrMGuszS6y9Zom11yyx9poly6+9Zvn/sSXL/48tWf5/bMny/2NLlv8fW7L879iS5X/Hlv0Y2Y+R/RjZj5H9GNmPkf0Y2Y+R/RjZj/FfjP9i/Bfjv8i6XWSV3v9R/m399/Xf139f/3399/Xf139f/3399/Xf13/fvK79fS6V6eey6ee0qWfLpp4Nm3oWbOoZsqknxaaeCJt6Amzqy7Sps6LOijoruqyosqLOiior6qyosqLOitqzYvf82D07ds+O3bNj9+zYPTt2z47ds2P37Ni99V67t9xr95Z77d5yr91b7rV7y712b7nX7i332r1NfS99p/0X+S/yX+S/yH+R/yL/Rf6L/Bf5L/Jf5L/Y0mRLky1NtjTZ0mRLky1NtjTZ0mRLky1NtjTZ0mRLky1NtjSZY5o5ZkYzw8xoZpAZTQwyw8hgMwwMNoPAYDMIDDZZZZNFFllkkUUWWWSRRRZZZJFFFllkkUUWWWSRRRY9iR5Ej6EH0UPoMfQQegy9jV5G76KX0avoXfQqeveS99DL6DX0MnoVvYreRS+iV9Gr6F30InoRvYhe/Vf9Ay7R9U9L6v9/AAAA//8DAIDU9P++nO5VAAAAAElFTkSuQmCC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>æ±ºç­–åŠ©æ‰‹ Pro</title>
    <style>
        :root { --primary: #FF9500; --bg: #F8F9FA; --card: #FFFFFF; --blue: #007AFF; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: env(safe-area-inset-top) 15px 20px; box-sizing: border-box; color: #333; }
        
        /* å°èˆª */
        .header { text-align: center; padding: 15px 0; position: sticky; top: 0; background: var(--bg); z-index: 100; }
        .back-btn { position: absolute; left: 0; top: 18px; display: none; background: #EEE; border: none; padding: 6px 12px; border-radius: 12px; font-weight: bold; cursor: pointer; }

        /* ä¹å®®æ ¼ä¸»é¸å–® */
        .home-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        .menu-item { background: var(--card); border-radius: 24px; padding: 30px 15px; text-align: center; box-shadow: 0 8px 20px rgba(0,0,0,0.04); transition: 0.2s; border: 1px solid rgba(0,0,0,0.02); }
        .menu-item:active { transform: scale(0.95); background: #F2F2F7; }
        .menu-item .icon { font-size: 45px; margin-bottom: 12px; display: block; }
        .menu-item .label { font-weight: bold; font-size: 16px; color: #1C1C1E; }
        .menu-item.hero { grid-column: span 2; display: flex; align-items: center; justify-content: center; gap: 20px; padding: 35px; background: linear-gradient(135deg, #ffffff 0%, #fff5e6 100%); }

        /* åˆ†é¡ã€è¼¸å…¥èˆ‡æ¨™ç±¤é  */
        .controls { margin-bottom: 15px; }
        .input-row { display: flex; gap: 8px; margin-bottom: 15px; }
        input { flex: 1; border: 1.5px solid #D1D1D6; border-radius: 12px; padding: 12px; font-size: 15px; outline: none; }
        .add-btn { background: var(--primary); color: white; border: none; padding: 0 15px; border-radius: 12px; font-weight: bold; }
        .tab-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; -webkit-overflow-scrolling: touch; }
        .tab-item { white-space: nowrap; padding: 8px 16px; background: #E5E5EA; border-radius: 20px; font-size: 13px; cursor: pointer; color: #3A3A3C; }
        .tab-item.active { background: var(--primary); color: white; font-weight: bold; }

        /* çµæœé¡¯ç¤º */
        .result-container { background: #FFF; border: 2.5px dashed var(--primary); border-radius: 28px; padding: 40px 15px; text-align: center; margin: 15px 0; min-height: 80px; display: flex; flex-direction: column; justify-content: center; }
        .result-text { font-size: 38px; font-weight: 800; color: #FF4500; }
        
        /* æŒ‰éˆ•èˆ‡å‹•ä½œ */
        .main-roll-btn { background: #1C1C1E; color: white; border: none; width: 100%; padding: 20px; border-radius: 18px; font-size: 20px; font-weight: bold; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .action-grid { display: none; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; animation: fadeInUp 0.4s; }
        .option-btn { padding: 14px; border-radius: 12px; text-decoration: none; color: white; font-size: 14px; text-align: center; font-weight: bold; border:none; cursor: pointer; }

        /* åœ°åœ–é¸æ“‡å½ˆçª— */
        .map-modal { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-radius: 24px 24px 0 0; padding: 20px; box-sizing: border-box; box-shadow: 0 -10px 30px rgba(0,0,0,0.15); z-index: 1000; }
        .map-option { padding: 15px; border-bottom: 1px solid #EEE; text-align: center; font-size: 18px; color: var(--blue); font-weight: 500; }
        .map-option:last-child { border: none; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 999; }

        /* æ­·å²è¶³è·¡ */
        .history-box { margin-top: 25px; text-align: left; }
        .history-title { font-size: 15px; font-weight: bold; color: #8E8E93; margin-bottom: 10px; }
        .history-tags { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag { background: #E5E5EA; padding: 6px 12px; border-radius: 10px; font-size: 13px; color: #333; }

        .page { display: none; }
        .active-page { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <button id="backBtn" class="back-btn" onclick="goHome()">â† è¿”å›</button>
        <h2 id="title">æ±ºç­–å°åŠ©æ‰‹</h2>
    </div>

    <div id="homePage" class="page active-page">
        <div class="home-grid">
            <div class="menu-item hero" onclick="goTo('food', 'ğŸ± åƒè²¨ç¥å™¨')">
                <span class="icon">ğŸ±</span>
                <span class="label">ä»Šå¤©åƒä»€éº¼ï¼Ÿ</span>
            </div>
            <div class="menu-item" onclick="goTo('play', 'ğŸ¡ å»å“ªç©å…’')">
                <span class="icon">ğŸ¡</span>
                <span class="label">å»å“ªç©å…’</span>
            </div>
            <div class="menu-item" onclick="goTo('dice', 'ğŸ² éš¨æ©Ÿæ“²éª°')">
                <span class="icon">ğŸ²</span>
                <span class="label">éš¨æ©Ÿæ“²éª°</span>
            </div>
            <div class="menu-item" onclick="goTo('truth', 'ğŸ’¬ çœŸå¿ƒè©±')">
                <span class="icon">ğŸ’¬</span>
                <span class="label">çœŸå¿ƒè©±</span>
            </div>
            <div class="menu-item" onclick="goTo('dare', 'ğŸ­ å¤§å†’éšª')">
                <span class="icon">ğŸ­</span>
                <span class="label">å¤§å†’éšª</span>
            </div>
        </div>
    </div>

    <div id="toolPage" class="page">
        <div class="controls">
            <div class="input-row">
                <input type="text" id="toolInput" placeholder="è‡ªå®šç¾©é …ç›®...">
                <button class="add-btn" onclick="saveCustom()">æ–°å¢</button>
            </div>
            <div class="tab-bar" id="tabBar"></div>
        </div>

        <div class="result-container">
            <div id="resultText" class="result-text">ï¼Ÿ</div>
        </div>
        
        <button class="main-roll-btn" onclick="runRoll()">é–‹å§‹éš¨æ©ŸæŠ½å–</button>

        <div id="actionGrid" class="action-grid">
            <a id="linkM" class="option-btn food-only" style="background:#FFD000;color:#333">ç¾åœ˜</a>
            <a id="linkD" class="option-btn food-only" style="background:#FF6633">é»è©•</a>
            <button class="option-btn play-only" style="background:#007AFF; grid-column: span 2;" onclick="showMapOptions()">æ‰“é–‹å°èˆª/åœ°åœ–</button>
            <button class="option-btn" style="background:#5856D6; grid-column: span 2;" onclick="shareCurrent()">åˆ†äº«çµæœ</button>
        </div>

        <div class="history-box">
            <div class="history-title">æœ€è¿‘æŠ½ä¸­</div>
            <div class="history-tags" id="historyTags"></div>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeMapOptions()"></div>
    <div class="map-modal" id="mapModal">
        <div style="font-weight: bold; margin-bottom: 15px; color:#666">é¸æ“‡åœ°åœ–æ‡‰ç”¨</div>
        <div class="map-option" onclick="openMap('google')">Google Maps</div>
        <div class="map-option" onclick="openMap('apple')">Apple Maps</div>
        <div class="map-option" onclick="openMap('gaode')">é«˜å¾·åœ°åœ–</div>
        <div class="map-option" onclick="openMap('baidu')">ç™¾åº¦åœ°åœ–</div>
        <div class="map-option" style="color:#FF3B30; border:none" onclick="closeMapOptions()">å–æ¶ˆ</div>
    </div>

<script>
    // 1. è³‡æ–™åº«è¨­è¨ˆ
    let db = {
        food: {
            custom: JSON.parse(localStorage.getItem('f_custom')) || ["ç«é‹", "å£½å¸", "ç‚¸é›"],
            hot: ["æ¼¢å ¡", "æ‹‰éºµ", "ç‰›æ’", "ç¾©å¤§åˆ©éºµ", "æ°´é¤ƒ"],
            chinese: ["é…¸èœé­š", "å°ç± åŒ…", "éº»è¾£ç‡™", "æ»·è‚‰é£¯", "çƒ¤é´¨"],
            history: JSON.parse(localStorage.getItem('f_hist')) || []
        },
        play: {
            custom: JSON.parse(localStorage.getItem('p_custom')) || ["çˆ¬å±±", "çœ‹é›»å½±"],
            indoor: ["å¯†å®¤é€ƒè„«", "å”±KTV", "é€›å•†åœˆ", "èª å“æ›¸åº—", "å±•è¦½é¤¨"],
            outdoor: ["é‡é¤", "å–®è»ŠéŠ", "é€›å…¬åœ’", "æµ·é‚Šæ•£æ­¥", "è€è¡—"],
            history: JSON.parse(localStorage.getItem('p_hist')) || []
        },
        dice: { list: ["1", "2", "3", "4", "5", "6"] },
        truth: { list: ["æœ€å¾Œä¸€å¼µç…§ç‰‡", "æœ€é†œçš„ä¸€ä»¶äº‹", "åˆå»å¹¾æ­²", "ç¾å ´å°è¦–"] },
        dare: { list: ["å­¸è²“å«", "çµ¦ç¬¬ä¸‰äººç™¼è¨Šæ¯", "å¤§è²å”±æ­Œ", "åšæ·±è¹²"] }
    };

    let currentPage = ''; 
    let currentTab = 'custom';
    let lastResult = '';

    // 2. å°èˆªé‚è¼¯
    function goTo(pageId, title) {
        currentPage = pageId;
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById('backBtn').style.display = 'block';
        document.getElementById('title').innerText = title;
        document.getElementById('toolPage').classList.add('active-page');
        
        initTabs();
        renderHistory();
        resetResult();
    }

    function goHome() {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById('homePage').classList.add('active-page');
        document.getElementById('backBtn').style.display = 'none';
        document.getElementById('title').innerText = 'æ±ºç­–å°åŠ©æ‰‹';
    }

    // 3. æ¨™ç±¤èˆ‡è‡ªå®šç¾©é‚è¼¯
    function initTabs() {
        const bar = document.getElementById('tabBar');
        bar.innerHTML = '';
        if (currentPage === 'food' || currentPage === 'play') {
            const tabs = currentPage === 'food' ? 
                [['custom','æˆ‘çš„'], ['hot','ç†±é–€'], ['chinese','ä¸­å¼']] : 
                [['custom','æˆ‘çš„'], ['indoor','å®¤å…§'], ['outdoor','æˆ¶å¤–']];
            
            tabs.forEach(([key, label]) => {
                const div = document.createElement('div');
                div.className = `tab-item ${currentTab === key ? 'active' : ''}`;
                div.innerText = label;
                div.onclick = (e) => switchTab(key, e.target);
                bar.appendChild(div);
            });
            document.querySelector('.controls').style.display = 'block';
        } else {
            document.querySelector('.controls').style.display = 'none';
        }
    }

    function switchTab(key, el) {
        currentTab = key;
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        el.classList.add('active');
        resetResult();
    }

    function saveCustom() {
        const val = document.getElementById('toolInput').value.trim();
        if(val) {
            db[currentPage].custom.push(val);
            localStorage.setItem(`${currentPage === 'food' ? 'f' : 'p'}_custom`, JSON.stringify(db[currentPage].custom));
            document.getElementById('toolInput').value = '';
            alert("æˆåŠŸæ–°å¢ï¼");
        }
    }

    // 4. éš¨æ©Ÿé‚è¼¯
    function runRoll() {
        let list = [];
        if (currentPage === 'food' || currentPage === 'play') {
            list = db[currentPage][currentTab];
        } else {
            list = db[currentPage].list;
        }

        const resEl = document.getElementById('resultText');
        const actionEl = document.getElementById('actionGrid');
        actionEl.style.display = 'none';

        let i = 0;
        const timer = setInterval(() => {
            resEl.innerText = list[Math.floor(Math.random() * list.length)];
            if(i++ > 15) {
                clearInterval(timer);
                lastResult = list[Math.floor(Math.random() * list.length)];
                resEl.innerText = "âœ¨ " + lastResult;
                showActions();
                if (db[currentPage].history) addHistory(lastResult);
            }
        }, 60);
    }

    function showActions() {
        const grid = document.getElementById('actionGrid');
        grid.style.display = 'grid';
        
        // åˆ‡æ›æŒ‰éˆ•é¡¯ç¤º
        document.querySelectorAll('.food-only').forEach(el => el.style.display = (currentPage === 'food' ? 'block' : 'none'));
        document.querySelectorAll('.play-only').forEach(el => el.style.display = (currentPage === 'play' ? 'block' : 'none'));

        if(currentPage === 'food') {
            const q = encodeURIComponent(lastResult);
            document.getElementById('linkM').href = `imeituan://www.meituan.com/s/s?w=${q}`;
            document.getElementById('linkD').href = `dianping://search?keyword=${q}`;
        }
    }

     // 5. åœ°åœ–æ·±åº¦é€£çµ (ä¿®æ­£å¾Œçš„é«˜å¾·ã€ç™¾åº¦è·³è½‰)
    function showMapOptions() {
        document.getElementById('mapModal').style.display = 'block';
        document.getElementById('overlay').style.display = 'block';
    }

    function closeMapOptions() {
        document.getElementById('mapModal').style.display = 'none';
        document.getElementById('overlay').style.display = 'none';
    }

    function openMap(type) {
        const q = encodeURIComponent(lastResult);
        let appUrl = '';
        let webUrl = '';

        // æ ¹æ“šåœ°åœ–é¡å‹è¨­å®šä¸åŒçš„ App å”è­°èˆ‡ç¶²é å‚™æ¡ˆ
        switch(type) {
            case 'google': 
                appUrl = `comgooglemaps://?q=${q}`; 
                webUrl = `https://www.google.com/maps/search/${q}`;
                break;
            case 'apple': 
                appUrl = `http://maps.apple.com/?q=${q}`; 
                webUrl = `http://maps.apple.com/?q=${q}`;
                break;
            case 'gaode': 
                // iOS ä½¿ç”¨ iosamap://, Android æœƒè‡ªå‹•è­˜åˆ¥é—œéµå­—æœå°‹
                appUrl = `iosamap://search?sourceApplication=foodapp&keywords=${q}&style=2`;
                webUrl = `https://uri.amap.com/search?keyword=${q}`;
                break;
            case 'baidu': 
                // ç™¾åº¦æœå°‹æ¥å£
                appUrl = `baidumap://map/search?query=${q}&src=webapp.food.decision`;
                webUrl = `https://api.map.baidu.com/geocoder?address=${q}&output=html`;
                break;
        }
        
        // å˜—è©¦å–šèµ· App
        const startTime = Date.now();
        window.location.href = appUrl;

        // ä¿éšªæ©Ÿåˆ¶ï¼šå¦‚æœ 2 ç§’å¾Œæ²’é›¢é–‹é é¢ï¼Œä»£è¡¨æ²’è£ App æˆ–è·³è½‰å¤±æ•—ï¼Œæ”¹é–‹ç¶²é ç‰ˆ
        setTimeout(() => {
            if (Date.now() - startTime < 2500) {
                window.location.href = webUrl;
            }
        }, 2000);

        closeMapOptions();
    }

        
        // å˜—è©¦æ‰“é–‹ Appï¼Œå¤±æ•—å‰‡è·³è½‰ Web ç‰ˆ
        window.location.href = url;
        setTimeout(() => {
            if(type==='google') window.location.href = `https://www.google.com/maps/search/${q}`;
        }, 500);
        closeMapOptions();
    }

    // 6. æ­·å²ç´€éŒ„
    function addHistory(item) {
        let hist = db[currentPage].history;
        hist.unshift(item);
        if(hist.length > 6) hist.pop();
        localStorage.setItem(`${currentPage === 'food' ? 'f' : 'p'}_hist`, JSON.stringify(hist));
        renderHistory();
    }

    function renderHistory() {
        const box = document.getElementById('historyTags');
        const hist = db[currentPage].history || [];
        box.innerHTML = hist.map(h => `<span class="tag">${h}</span>`).join('');
    }

    function resetResult() {
        document.getElementById('resultText').innerText = 'ï¼Ÿ';
        document.getElementById('actionGrid').style.display = 'none';
    }

    function shareCurrent() {
        if(navigator.share) navigator.share({ title:'æˆ‘çš„æ±ºå®š', text:`å»ºè­°ï¼š${lastResult}ï¼`, url:window.location.href });
    }
</script>
</body>
</html>
