<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="apple-touch-icon" href="https://img.icons8.com/plasticine/180/hamburger.png">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="åƒè²¨ç¥å™¨">

    <style>
        :root { 
            --primary: #FF9500; 
            --bg: #FFFFFF; 
        }

        /* 4. è§£æ±ºä¸Šæ–¹é»‘é‚Šçš„æœ€å¼· CSS æ–¹æ¡ˆ */
        html, body {
            margin: 0;
            padding: 0;
            background-color: var(--bg); /* å¼·åˆ¶èƒŒæ™¯èˆ‡ç¶²é åŒè‰² */
            height: 100%;
        }

        body { 
            font-family: -apple-system, sans-serif; 
            /* env(safe-area-inset-top) æœƒè‡ªå‹•åµæ¸¬ä¸¦å¡«å……åŠ‰æµ·å€åŸŸçš„ç©ºé–“ */
            padding-top: env(safe-area-inset-top); 
            display: flex; 
            justify-content: center;
            box-sizing: border-box;
        }

        .container { 
            background: white; 
            width: 100%; 
            max-width: 450px; 
            padding: 20px;
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* ... å…¶ä»–æ¨£å¼ä¿æŒä¸è®Š ... */
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center; margin-top:0;">ğŸ´ åƒè²¨ç¥å™¨</h1>

    <div class="input-group">
        <input type="text" id="customInput" placeholder="æ–°å¢ç§è—èœè‰²...">
        <button class="add-btn" onclick="addCustom()">æ–°å¢</button>
    </div>

    <div class="tabs" id="tabGroup">
        <div class="tab active" onclick="switchTheme('custom')">è‡ªå®šç¾©</div>
        <div class="tab" onclick="switchTheme('classic')">ç¶“å…¸æ¨è–¦</div>
        <div class="tab" onclick="switchTheme('chinese')">ä¸­å¼å…«å¤§èœ</div>
    </div>

    <div class="result-card">
        <div id="resultValue">ï¼Ÿ</div>
        <div class="action-btns" id="searchGroup" style="display:none">
            <div class="grid">
                <a id="linkMeituan" class="btn btn-meituan">ç¾åœ˜</a>
                <a id="linkDianping" class="btn btn-dianping">å¤§çœ¾é»è©•</a>
                <a id="linkEleme" class="btn btn-eleme">é¤“äº†éº¼</a>
                <a id="linkGoogle" class="btn btn-google">Google</a>
                <button class="btn btn-share" onclick="shareResult()">ğŸ“¤ åˆ†äº«å¥½å‹</button>
            </div>
        </div>
    </div>

    <button class="main-btn btn" onclick="roll()">é–‹å§‹éš¨æ©ŸæŠ½é¸</button>
</div>

<script>
    // åŒä¹‹å‰çš„ JavaScript é‚è¼¯...
    let myChoices = JSON.parse(localStorage.getItem('myChoices')) || ["ç«é‹", "æ‹‰éºµ", "ç‚¸é›"];
    const database = {
        custom: myChoices,
        classic: ["æ¼¢å ¡", "ç‰›æ’", "ç‰›è‚‰éºµ", "å°ç± åŒ…", "ç¾©å¤§åˆ©éºµ"],
        chinese: ["å·èœ", "ç²µèœ", "é­¯èœ", "è˜‡èœ", "æµ™èœ"]
    };
    let currentKey = 'custom';
    let finalChoice = "";

    function switchTheme(key) {
        currentKey = key;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('resultValue').innerText = 'ï¼Ÿ';
        document.getElementById('searchGroup').style.display = 'none';
    }

    function addCustom() {
        const input = document.getElementById('customInput');
        if (input.value.trim()) {
            database.custom.push(input.value.trim());
            localStorage.setItem('myChoices', JSON.stringify(database.custom));
            input.value = "";
            switchTheme('custom');
        }
    }

    function roll() {
        const list = database[currentKey];
        const display = document.getElementById('resultValue');
        const searchGroup = document.getElementById('searchGroup');
        searchGroup.style.display = 'none';
        let count = 0;
        const timer = setInterval(() => {
            display.innerText = list[Math.floor(Math.random() * list.length)];
            count++;
            if (count > 15) {
                clearInterval(timer);
                finalChoice = list[Math.floor(Math.random() * list.length)];
                display.innerText = "âœ¨ " + finalChoice;
                updateSearchLinks(finalChoice);
                searchGroup.style.display = 'block';
            }
        }, 80);
    }

    function updateSearchLinks(keyword) {
        const encoded = encodeURIComponent(keyword);
        document.getElementById('linkMeituan').href = `imeituan://www.meituan.com/s/s?w=${encoded}`;
        document.getElementById('linkDianping').href = `dianping://search?keyword=${encoded}`;
        document.getElementById('linkEleme').href = `eleme://search?keyword=${encoded}`;
        document.getElementById('linkGoogle').href = `https://www.google.com/maps/search/${encoded}`;
    }

    async function shareResult() {
        if (navigator.share) {
            await navigator.share({ title: 'åƒè²¨ç¥å™¨', text: `æ±ºå®šåƒï¼š${finalChoice}ï¼`, url: window.location.href });
        }
    }
</script>
</body>
</html>
