<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgCAMAAAC8Y9NQAAAAflBMVEUAAAD///+ZzP8Anf8Aov8Amv8AlP8Aqv8Aru8Anv8Amf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8Anf8+S878AAAALHRSTlMAAgMEBQYICQoLDA0ODxITFBUWFxgZGhscHR4fICEiIyQlJicoKSorLC0uLzAyYm98AAADfklEQVR42u2b2ZKiMBSG6Y6ICwiCuyK7oiIu77/S6YI6pS0SuAnTOf9vXpIsS/6T9CStVAsLCwsLCwsLCwsLC5vIdI59f6E9yGofBclKjO8T36Y9x5ovp3W9v6D9L1Hk++Fm62v7X+K680U2qfX+gnSAnX6W6v0FCXp/QTrA82T6pPr67/8LkuM8nU6fA+MvSJDmP9Ppc+A9Vf8XJMn0fDqdPmP9X5CcTOfp9Bmz/oKkkOnV6TNR/xc0S86m06fA7P8LmmM6nz4DZv9f0DyfptOnwGf8Bcm5m6fT58Bl/AXJWZpOnwPn8RckZ0un0+fAefwFyVkt06fA97v6779z/3f0v/P0Of9vSJK5/f7D3P4/p86Xf9m+f9L5/knnf9L5/knnf9L5/knnf9L5/knnf9L5/knnf9L5/knnf/L5fX069/90Wf/H38B1X7R+B8XnE4vPZ7Otz2Zdn82mPptVfTar+mxW9dlmS6U5WyrN2VJpzpZK602ltN5USutNpbTeVErrTaW03lRar7XGfK015mutMV9rjflaY77WGPu7mGv7u5hr+7uYa/u7mGv7u5hr+7uY6zNrrM+ssT6zxvrMGuszS6y9Zom11yyx9poly6+9Zvn/sSXL/48tWf5/bMny/2NLlv8fW7L879iS5X/Hlv0Y2Y+R/RjZj5H9GNmPkf0Y2Y+R/RjZj/FfjP9i/Bfjv8i6XWSV3v9R/m399/Xf139f/3399/Xf139f/3399/Xf13/fvK79fS6V6eey6ee0qWfLpp4Nm3oWbOoZsqknxaaeCJt6Amzqy7Sps6LOijoruqyosqLOiior6qyosqLOitqzYvf82D07ds+O3bNj9+zYPTt2z47ds2P37Ni99V67t9xr95Z77d5yr91b7rV7y712b7nX7i332r1NfS99p/0X+S/yX+S/yH+R/yL/Rf6L/Bf5L/Jf5L/Y0mRLky1NtjTZ0mRLky1NtjTZ0mRLky1NtjTZ0mRLky1NtjSZY5o5ZkYzw8xoZpAZTQwyw8hgMwwMNoPAYDMIDDZZZZNFFllkkUUWWWSRRRZZZJFFFllkkUUWWWSRRRY9iR5Ej6EH0UPoMfQQegy9jV5G76KX0avoXfQqeveS99DL6DX0MnoVvYreRS+iV9Gr6F30InoRvYhe/Vf9Ay7R9U9L6v9/AAAA//8DAIDU9P++nO5VAAAAAElFTkSuQmCC">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>æ±ºç­–åŠ©æ‰‹ Pro</title>
    <style>
        :root { 
            --primary: #FF9500; 
            --blue: #007AFF; 
            --red: #FF3B30;
            --glass: rgba(255, 255, 255, 0.75); /* æ¯›ç»ç’ƒèƒŒæ™¯è‰² */
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            /* å„ªåŒ–å¾Œçš„æŸ”å’Œæ¼¸å±¤èƒŒæ™¯ */
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); 
            background-attachment: fixed;
            margin: 0; 
            padding: env(safe-area-inset-top) 15px 20px; 
            box-sizing: border-box; 
            color: #1c1c1e; 
            -webkit-tap-highlight-color: transparent; 
            min-height: 100vh;
        }

        .header { text-align: center; padding: 15px 0; position: sticky; top: 0; z-index: 100; }
        .header h2 { font-weight: 800; color: #333; letter-spacing: 0.5px; margin: 0; }
        
        .back-btn { position: absolute; left: 0; top: 18px; display: none; background: var(--glass); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); padding: 6px 14px; border-radius: 14px; font-weight: bold; cursor: pointer; }

        .home-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px; }
        
        /* æ¯›ç»ç’ƒå¡ç‰‡æ¨£å¼ */
        .menu-item { 
            background: var(--glass) !important; 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4) !important;
            border-radius: 28px !important; 
            padding: 25px 15px; 
            text-align: center; 
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.07) !important; 
            transition: 0.3s; 
        }
        .menu-item:active { transform: scale(0.96); background: rgba(255,255,255,0.85) !important; }
        
        .menu-item .icon { 
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 18px;
            margin-bottom: 12px;
            font-size: 35px !important;
        }
        .menu-item .label { font-weight: bold; font-size: 16px; color: #333; }
        .menu-item.hero { grid-column: span 2; flex-direction: row; display: flex; align-items: center; justify-content: center; gap: 20px; padding: 30px; }

        .controls { margin-bottom: 15px; }
        .input-row { display: flex; gap: 8px; margin-bottom: 15px; }
        input { flex: 1; border: 1px solid rgba(0,0,0,0.1); background: var(--glass); border-radius: 14px; padding: 12px 16px; font-size: 15px; outline: none; backdrop-filter: blur(5px); }
        
        .add-btn { background: var(--primary); color: white; border: none; padding: 0 18px; border-radius: 14px; font-weight: bold; }

        .tab-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; }
        .tab-item { white-space: nowrap; padding: 8px 18px; background: rgba(0,0,0,0.05); border-radius: 20px; font-size: 13px; font-weight: 500; cursor: pointer; }
        .tab-item.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(255,149,0,0.3); }

        /* çµæœå®¹å™¨å„ªåŒ– */
        .result-container { 
            background: var(--glass) !important; 
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px dashed rgba(255, 149, 0, 0.3) !important; 
            border-radius: 30px !important; 
            padding: 40px 15px; 
            text-align: center; 
            margin: 20px 0; 
            min-height: 80px; 
        }
        .result-text { font-size: 40px; font-weight: 900; color: #FF4500; text-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        
        .main-roll-btn { 
            background: #1c1c1e; color: white; border: none; width: 100%; padding: 18px; border-radius: 20px; 
            font-size: 19px; font-weight: bold; box-shadow: 0 10px 25px rgba(0,0,0,0.15); cursor: pointer; 
        }

        .action-grid { display: none; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; }
        .option-btn { padding: 14px; border-radius: 15px; text-decoration: none; color: white; font-size: 14px; text-align: center; font-weight: bold; border:none; cursor: pointer; }

        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.3); z-index: 999; backdrop-filter: blur(4px); }
        .map-modal, .admin-modal { 
            display: none; position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(255,255,255,0.9); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border-radius: 28px 28px 0 0; padding: 25px 20px; box-sizing: border-box; z-index: 1000; 
        }
        .admin-modal { bottom: auto; top: 50%; transform: translate(0, -50%); width: 90%; left: 5%; border-radius: 28px; }
        .map-option { padding: 16px; border-bottom: 1px solid rgba(0,0,0,0.05); text-align: center; font-size: 18px; color: var(--blue); font-weight: 600; }

        .tag { background: rgba(255,255,255,0.6); padding: 7px 14px; border-radius: 12px; font-size: 13px; font-weight: 500; border: 1px solid rgba(255,255,255,0.4); }
        .page { display: none; }
        .active-page { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="header">
        <button id="backBtn" class="back-btn" onclick="goHome()">â†</button>
        <h2 id="title">æ±ºç­–å°åŠ©æ‰‹</h2>
    </div>

    <div id="homePage" class="page active-page">
        <div class="home-grid">
            <div class="menu-item hero" onclick="goTo('food', 'ğŸ± åƒè²¨ç¥å™¨')">
                <span class="icon">ğŸ±</span><span class="label">ä»Šå¤©åƒä»€éº¼ï¼Ÿ</span>
            </div>
            <div class="menu-item" onclick="goTo('play', 'ğŸ¡ å»å“ªç©å…’')">
                <span class="icon">ğŸ¡</span><span class="label">å»å“ªç©å…’</span>
            </div>
            <div class="menu-item" onclick="goTo('dice', 'ğŸ’¸ èª°è²·å–®')">
                <span class="icon">ğŸ’¸</span><span class="label">èª°è²·å–® / èšæœƒ</span>
            </div>
            <div class="menu-item" onclick="goTo('truth', 'ğŸ’¬ çœŸå¿ƒè©±')">
                <span class="icon">ğŸ’¬</span><span class="label">çœŸå¿ƒè©±</span>
            </div>
            <div class="menu-item" onclick="goTo('dare', 'ğŸ­ å¤§å†’éšª')">
                <span class="icon">ğŸ­</span><span class="label">å¤§å†’éšª</span>
            </div>
        </div>
    </div>

    <div id="toolPage" class="page">
        <div class="controls" id="controlsArea">
            <div class="input-row">
                <input type="text" id="toolInput" placeholder="è‡ªå®šç¾©é …ç›®...">
                <button class="add-btn" onclick="handleInput()">æ–°å¢</button>
            </div>
            <div class="tab-bar" id="tabBar"></div>
        </div>
        <div class="result-container"><div id="resultText" class="result-text">ï¼Ÿ</div></div>
        <button class="main-roll-btn" onclick="runRoll()">é–‹å§‹æŠ½å–</button>
        <div id="actionGrid" class="action-grid">
            <a id="linkM" class="option-btn food-only" style="background:#FFD000;color:#333">ç¾åœ˜</a>
            <a id="linkD" class="option-btn food-only" style="background:#FF6633">é»è©•</a>
            <button class="option-btn play-only" style="background:var(--blue); grid-column: span 2;" onclick="showMapOptions()">åœ°åœ–å°èˆª</button>
            <button class="option-btn" id="shareBtn" style="background:#5856D6; grid-column: span 2;" onclick="shareCurrent()">åˆ†äº«çµæœ</button>
        </div>
        <div class="history-box" style="margin-top:30px">
            <div id="historyTitle" style="font-weight: bold; color: #666; font-size: 14px; margin-bottom: 10px;">æœ€è¿‘æŠ½ä¸­</div>
            <div class="history-tags" id="historyTags" style="display:flex; flex-wrap:wrap; gap:8px;"></div>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeModals()"></div>
    <div class="map-modal" id="mapModal">
        <div style="font-weight: bold; margin-bottom: 15px; color:#666; text-align: center;">é¸æ“‡å°èˆª</div>
        <div class="map-option" onclick="openMap('google')">Google Maps</div>
        <div class="map-option" onclick="openMap('apple')">Apple Maps</div>
        <div class="map-option" onclick="openMap('gaode')">é«˜å¾·åœ°åœ–</div>
        <div class="map-option" onclick="openMap('baidu')">ç™¾åº¦åœ°åœ–</div>
        <div class="map-option" style="color:var(--red); border:none" onclick="closeModals()">å–æ¶ˆ</div>
    </div>

    <div class="admin-modal" id="adminModal">
        <h3 style="margin:0 0 15px 0; text-align: center;">ğŸ¤« éš±è—æ§åˆ¶ä¸­å¿ƒ</h3>
        <div class="input-row">
            <input type="text" id="adminInput" placeholder="è¼¸å…¥åå­—">
            <button class="add-btn" style="background:var(--red)" onclick="setAdmin('black')">é»‘</button>
            <button class="add-btn" style="background:var(--blue)" onclick="setAdmin('white')">ç™½</button>
        </div>
        <div id="adminList" style="margin-top:15px; max-height:150px; overflow-y:auto; display:flex; flex-wrap:wrap; gap:5px;"></div>
        <button class="main-roll-btn" style="margin-top:20px; padding:12px; font-size:16px" onclick="closeModals()">å®Œæˆè¨­ç½®</button>
    </div>

<script>
    let db = {
        food: { custom: JSON.parse(localStorage.getItem('f_custom')) || ["ç«é‹", "å£½å¸"], hot: ["æ¼¢å ¡", "æ‹‰éºµ", "ç‰›æ’"], chinese: ["å°ç± åŒ…", "æ»·è‚‰é£¯"], history: JSON.parse(localStorage.getItem('f_hist')) || [] },
        play: { custom: JSON.parse(localStorage.getItem('p_custom')) || ["çœ‹é›»å½±", "çˆ¬å±±"], indoor: ["å¯†å®¤", "KTV"], outdoor: ["å…¬åœ’", "è€è¡—"], history: JSON.parse(localStorage.getItem('p_hist')) || [] },
        dice: { bill: JSON.parse(localStorage.getItem('party_names')) || ["å¼µä¸‰", "æå››"], random: ["1","2","3","4","5","6"] },
        truth: { list: ["æ‰‹æ©Ÿæœ€å¾Œä¸€å¼µç…§ç‰‡", "æœ€å°·å°¬çš„å›æ†¶", "å¿ƒè·³æœ€å¿«çš„ä¸€æ¬¡"] },
        dare: { list: ["å­¸è²“å«", "çµ¦ç¬¬ä¸‰äººç™¼è¨Šæ¯", "å¤§è²å”±æ­Œ"] }
    };
    let adminDb = JSON.parse(localStorage.getItem('admin_db')) || { black: [], white: [] };
    let currentPage = '', currentTab = '', lastResult = '';

    function goTo(pageId, title) {
        currentPage = pageId; currentTab = (pageId === 'dice') ? 'bill' : 'custom';
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById('backBtn').style.display = 'block';
        document.getElementById('title').innerText = title;
        document.getElementById('toolPage').classList.add('active-page');
        initTabs(); renderHistory(); resetResult();
    }

    function goHome() {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
        document.getElementById('homePage').classList.add('active-page');
        document.getElementById('backBtn').style.display = 'none';
        document.getElementById('title').innerText = 'æ±ºç­–å°åŠ©æ‰‹';
    }

    function initTabs() {
        const bar = document.getElementById('tabBar'); bar.innerHTML = '';
        let tabs = [];
        if (currentPage === 'food') tabs = [['custom','æˆ‘çš„'],['hot','ç†±é–€'],['chinese','ä¸­å¼']];
        else if (currentPage === 'play') tabs = [['custom','æˆ‘çš„'],['indoor','å®¤å…§'],['outdoor','æˆ¶å¤–']];
        else if (currentPage === 'dice') tabs = [['bill','èª°è²·å–®'],['random','éª°å­']];
        tabs.forEach(([k, l]) => {
            const d = document.createElement('div');
            d.className = `tab-item ${currentTab === k ? 'active' : ''}`;
            d.innerText = l; d.onclick = () => { currentTab = k; initTabs(); resetResult(); renderHistory(); };
            bar.appendChild(d);
        });
        document.getElementById('controlsArea').style.display = (tabs.length > 0) ? 'block' : 'none';
    }

    function handleInput() {
        const val = document.getElementById('toolInput').value.trim();
        if(val === '#admin') { document.getElementById('toolInput').value = ''; showAdmin(); return; }
        if(!val) return;
        if (currentPage === 'dice' && currentTab === 'bill') {
            val.split(/\s+/).forEach(n => { if(!db.dice.bill.includes(n)) db.dice.bill.push(n); });
            localStorage.setItem('party_names', JSON.stringify(db.dice.bill));
        } else if (db[currentPage].custom) {
            db[currentPage].custom.push(val);
            localStorage.setItem(currentPage.charAt(0)+'_custom', JSON.stringify(db[currentPage].custom));
        }
        document.getElementById('toolInput').value = ''; renderHistory();
    }

    function runRoll() {
        let list = (currentPage === 'truth' || currentPage === 'dare') ? db[currentPage].list : db[currentPage][currentTab];
        if(!list || list.length === 0) return alert("åå–®ç‚ºç©º");
        let weightList = [];
        if (currentPage === 'dice' && currentTab === 'bill') {
            list.forEach(name => {
                if (adminDb.white.includes(name)) return;
                if (adminDb.black.includes(name)) { for(let k=0; k<12; k++) weightList.push(name); }
                else { weightList.push(name); }
            });
            if(weightList.length === 0) weightList = list;
        } else { weightList = list; }
        const resEl = document.getElementById('resultText');
        let i = 0;
        const timer = setInterval(() => {
            resEl.innerText = list[Math.floor(Math.random() * list.length)];
            if(i++ > 15) {
                clearInterval(timer);
                lastResult = weightList[Math.floor(Math.random() * weightList.length)];
                resEl.innerText = (currentTab === 'bill' ? "ğŸ’¸ " : "âœ¨ ") + lastResult;
                showSpecialButtons();
                if (currentPage !== 'dice' || currentTab !== 'bill') addHistory(lastResult);
            }
        }, 60);
    }

    function showSpecialButtons() {
        document.getElementById('actionGrid').style.display = 'grid';
        document.querySelectorAll('.food-only').forEach(e => e.style.display = (currentPage==='food'?'block':'none'));
        document.querySelectorAll('.play-only').forEach(e => e.style.display = (currentPage==='play'?'block':'none'));
        if(currentPage === 'food') {
            const q = encodeURIComponent(lastResult);
            document.getElementById('linkM').href = `imeituan://www.meituan.com/s/s?w=${q}`;
            document.getElementById('linkD').href = `dianping://search?keyword=${q}`;
        }
    }

    function openMap(type) {
        const q = encodeURIComponent(lastResult);
        let appUrl = '', webUrl = '';
        switch(type) {
            case 'google': appUrl = `comgooglemaps://?q=${q}`; webUrl = `https://www.google.com/maps/search/${q}`; break;
            case 'apple': appUrl = `http://maps.apple.com/?q=${q}`; webUrl = `http://maps.apple.com/?q=${q}`; break;
            case 'gaode': appUrl = `iosamap://search?sourceApplication=foodapp&keywords=${q}&style=2`; webUrl = `https://uri.amap.com/search?keyword=${q}`; break;
            case 'baidu': appUrl = `baidumap://map/search?query=${q}&src=webapp.food.decision`; webUrl = `https://api.map.baidu.com/geocoder?address=${q}&output=html`; break;
        }
        const start = Date.now();
        window.location.href = appUrl;
        setTimeout(() => { if (Date.now() - start < 2500) window.location.href = webUrl; }, 2000);
        closeModals();
    }

    function showAdmin() { document.getElementById('adminModal').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; renderAdminList(); }
    function setAdmin(type) {
        const n = document.getElementById('adminInput').value.trim();
        if(!n) return;
        adminDb.black = adminDb.black.filter(x => x !== n); adminDb.white = adminDb.white.filter(x => x !== n);
        adminDb[type].push(n); localStorage.setItem('admin_db', JSON.stringify(adminDb));
        document.getElementById('adminInput').value = ''; renderAdminList();
    }
    function renderAdminList() {
        document.getElementById('adminList').innerHTML = 
            adminDb.black.map(n => `<span class="tag" style="background:#FFE5E5;color:var(--red)" onclick="removeAdmin('black','${n}')">${n} é»‘</span>`).join('') +
            adminDb.white.map(n => `<span class="tag" style="background:#E5F0FF;color:var(--blue)" onclick="removeAdmin('white','${n}')">${n} ç™½</span>`).join('');
    }
    function removeAdmin(t, n) { adminDb[t] = adminDb[t].filter(x => x !== n); localStorage.setItem('admin_db', JSON.stringify(adminDb)); renderAdminList(); }
    function closeModals() { document.querySelectorAll('.map-modal, .admin-modal, .overlay').forEach(el => el.style.display = 'none'); }
    function showMapOptions() { document.getElementById('mapModal').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; }
    function renderHistory() {
        const box = document.getElementById('historyTags');
        if (currentPage === 'dice' && currentTab === 'bill') {
            document.getElementById('historyTitle').innerText = "åƒèˆ‡åå–® (é»æ“Šåˆªé™¤)";
            box.innerHTML = db.dice.bill.map(n => `<span class="tag" style="padding-right:25px;position:relative" onclick="removeFromBill('${n}')">${n}<b style="position:absolute;right:8px;opacity:0.3">Ã—</b></span>`).join('');
        } else {
            document.getElementById('historyTitle').innerText = "æœ€è¿‘æŠ½ä¸­";
            box.innerHTML = (db[currentPage].history || []).map(h => `<span class="tag">${h}</span>`).join('');
        }
    }
    function removeFromBill(n) { db.dice.bill = db.dice.bill.filter(x => x !== n); localStorage.setItem('party_names', JSON.stringify(db.dice.bill)); renderHistory(); }
    function addHistory(item) {
        db[currentPage].history.unshift(item); if(db[currentPage].history.length > 6) db[currentPage].history.pop();
        localStorage.setItem(currentPage.charAt(0) + '_hist', JSON.stringify(db[currentPage].history)); renderHistory();
    }
    function resetResult() { document.getElementById('resultText').innerText = 'ï¼Ÿ'; document.getElementById('actionGrid').style.display = 'none'; }
    function shareCurrent() {
        let t = (currentTab === 'bill') ? `è²·å–®å¤§å†¤ç¨®æ˜¯ï¼š${lastResult}ï¼` : `å»ºè­°çµæœï¼š${lastResult}`;
        if(navigator.share) navigator.share({ title:'æ±ºç­–çµæœ', text: t, url:window.location.href });
    }
</script>
</body>
</html>
